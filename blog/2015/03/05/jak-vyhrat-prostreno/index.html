<!DOCTYPE html>
<html lang="cs" dir="ltr" itemtype="http://schema.org/WebPage" itemscope="">
    <head>
    
    
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Jak vyhrát Prostřeno? | fragaria.cz</title>
    <meta name="author" content="Fragaria s.r.o." />
    <meta name="robots" content="index,follow" />
    <meta name="description" content="Jak uspět v populární soutěži? Analýza dat s použitím Elasticsearchukazuje, že uspějete s českou klasikou: domácí hovězí vývar s nudlemi,kuře s bramborem a koláč. Ale taky se hodí někoho milovat,jmenovat se Lucie a hrát hokej.Jak jsem na to přišel?">
    <meta name="keywords" content="fragaria, software, vývoj software, webové aplikace, python, javascript, angular, elasticsearch, html, css, npmelasticsearchnodejsprostreno" />
    <!-- Favicons -->
    

    <meta property="og:url"           content="https://fragaria.cz/website/blog/2015/03/05/jak-vyhrat-prostreno/" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="Jak vyhrát Prostřeno? | fragaria.cz" />
    <meta property="og:description"   content="Jak uspět v populární soutěži? Analýza dat s použitím Elasticsearchukazuje, že uspějete s českou klasikou: domácí hovězí vývar s nudlemi,kuře s bramborem a koláč. Ale taky se hodí někoho milovat,jmenovat se Lucie a hrát hokej.Jak jsem na to přišel?" />

    

    
    <link rel="stylesheet" href="/website/assets/styles.css">
    <link rel="alternate" type="application/atom+xml" href="/website/feed.xml" title="Atom feed for this page"/>
    <link rel="self" type="application/atom+xml" href="/website/feed.xml"/>
</head>



    <body class="page-container baseline-grid ">
        <div class="page-container__inner">
            <div class="content-block js-sitenav">
    <nav class="sitenav" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
        <a href="/website/">
            <img alt="Fragaria s.r.o." class="sitenav__brand" src="/website/assets/img/strawberry.svg">
        </a>

        <ul class="sitenav__linkset">
            <li class="sitenav__linkset-item sitenav__linkset-item--main"><a href="/website/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Fragaria.cz</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/#works" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Works</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/#team" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Team</span></a></li>
            
                <li class="sitenav__linkset-item sitenav__linkset-item--active"><a href="/website/blog/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Blog</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/career/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Career</span></a></li>
            
        </ul>

        <div class="sitenav__menu-toggle typeset">
            <a href="#" class="sitenav__menu-toggle-link js-sitenav-menu-toggle">Menu</a>
        </div>
    </nav>
</div>


            <article itemtype="https://schema.org/TechArticle" itemscope class="article">
    <div class="content-block typeset">
        <h1 itemprop="name" class="article__headline">Jak vyhrát Prostřeno?</h1>
        <meta itemprop="headline" content="Jak vyhrát Prostřeno?">

        
            <meta itemprop="image" content="http://3.bp.blogspot.com/-dE37yw9kiTc/VPMxPANTwfI/AAAAAAAAAe4/wduKmRTPMm8/s72-c/Screen%2BShot%2B2015-03-01%2Bat%2B15.40.31.png">
        

        <p class="article__meta">
            <span itemprop="author" itemtype="http://schema.org/Person" itemscope="" class="article__author">
                by <span itemprop="name">Lukáš Marek</span>
            </span>
            <meta itemprop="datePublished" content="" />
            <span class="article__pubdate">05.03.2015</span>
            <meta itemprop="publisher"></meta>
        </p>

        

        <div class="article__content-wrap">
            <div class="article__content">
                <p>Jak uspět v populární soutěži? Analýza dat s použitím Elasticsearch
ukazuje, že uspějete s českou klasikou: <strong>domácí hovězí vývar s nudlemi,
kuře s bramborem a koláč</strong>. Ale taky se hodí někoho <strong>milovat</strong>,
jmenovat se <strong>Lucie</strong> a hrát <strong>hokej</strong>.
Jak jsem na to přišel?</p>

<p>Moje drahá polovička je velká fanynka pořadu
Prostřeno. Dost často se tak vrátím z práce domů a z obýváku zrovna
nadšeně hýká Vašek Vydra.
Pro neznalé – <a href="http://www.iprima.cz/prostreno/o-poradu">Prostřeno</a> je
pořad televize Prima, ve kterém:</p>

<blockquote>
  <p>„Pětice amatérských kuchařů, milovníků dobrého jídla a pití, během
jednoho týdne postupně předvede, jak si představuje perfektní večeři
včetně zábavy pro hosty, kteří se dříve neznali.“</p>
</blockquote>

<p>Při nedobrovolném sledování mě napadlo, jestli existuje něco jako
<strong>ideální menu</strong> – tedy zda <em>lze sestavit večeři s velkou
pravděpodobností výhry?</em>
Show běží už pět let a po celou tu dobu udržuje webové stránky, na
kterých lze nalézt recepty jednotlivých účastníků. To už je spousta
dat, ze kterých se dá ledacos vyčíst.
Nejdřív ovšem ta data musíme dostat do použitelné podoby. Prima bohužel
neposkytuje API (proč taky), takže to je třeba zrobit ručně.</p>

<h3 id="příprava">Příprava</h3>

<p>Než se pustíme do samotného programování, je potřeba se podívat, jak
stránky Prostřeno vůbec vypadají. Začneme na <a href="http://www.iprima.cz/prostreno/soutezici?day=1267448067">stránce s nejstarším
vysíláním</a>.</p>

<p><a href="http://3.bp.blogspot.com/-dE37yw9kiTc/VPMxPANTwfI/AAAAAAAAAe4/wduKmRTPMm8/s1600/Screen%2BShot%2B2015-03-01%2Bat%2B15.40.31.png"><img src="http://3.bp.blogspot.com/-dE37yw9kiTc/VPMxPANTwfI/AAAAAAAAAe4/wduKmRTPMm8/s400/Screen%2BShot%2B2015-03-01%2Bat%2B15.40.31.png" alt="" /></a></p>

<p>Vidíme pět soutěžících, z nichž František je označen korunkou – vítěz
kola. Je poznat, že stránky dělal někdo zodpovědný – obrázek každého
účastníka je obalen v <code class="highlighter-rouge">div</code>u s třídou <code class="highlighter-rouge">prostreno-contestant</code>. Vítěz má
ještě navíc třídu <code class="highlighter-rouge">tvwinner</code>.
S tím už se dá pracovat.</p>

<h3 id="sbíráme-data">Sbíráme data</h3>

<p>Pro sběr dat jsem si připravil jednoduchý skript v NodeJS, který, který
načte data ze stránek Primy a uloží je ve formátu JSON do databáze
Elasticsearch. Formát uložených dat je následující:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "predkrm": "Kuřecí salát v broskvi",
  "hlavni": "Candát s mandlovou nádivkou a šťouchané brambory",
  "zakusek": "Líná hospodyňka",
  "id": "jiri-mueller",
  "winner": true,
  "gender": "M",
  "desc": "\n       Je ženatý, má čtyři děti ... atd."
}
</code></pre></div></div>

<p>Nebudu se tady pouštět do detailů a případného zájemce odkážu na
<a href="https://gist.github.com/krtek/a3d9d68081ec629a5a16">kompletní zdrojové
kódy</a>.</p>

<h3 id="agregujeme-data">Agregujeme data</h3>

<p>Data se mi úspěšně podařilo nacpat do Elasticsearch, který mám nastavený
podle <a href="http://blog.fragaria.cz/2014/11/fulltext-cesky-pomoci-djanga.html">Filipova
návodu</a>
tak, aby uměl pracoval s češtinou. Teď nastává ta nejzábavnější část –
analýza dat. Elasticsearch poskytuje mocné API pro <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations.html">agregace
dat</a>.
Pojďme si pro začátek zjistit nejčastější vítězné polévky. Dotaz do
Elasticsearch bude vypadat následovně:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "query": {
      "match": {
        winner: true
      }
    },
    "aggregations": {
      "polevka": {
        "terms": {
          "field": "polevka",
          "size": 10
        }
      }
    }
  }
</code></pre></div></div>

<p>a odpověď Elasticsearch serveru bude:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    ...
    },
    "aggregations": {
      "polevka": {
        "doc_count_error_upper_bound": 5,
        "sum_other_doc_count": 276,
        "buckets": [{
          "key": "polevka",
          "doc_count": 69
        }, {
          "key": "vyvar",
          "doc_count": 32
        }, {
          "key": "nudle",
          "doc_count": 20
        }, {
          "key": "hovezi",
          "doc_count": 18
        }, {
          "key": "kremova",
          "doc_count": 18
        }, ...
        ]
      }
    }
  }
</code></pre></div></div>

<p>Nejčastějším slovem mezi vítěznými polévkami je překvapivě <strong>polévka</strong>.
To se dalo čekat. Ale hned na dalších místech je <strong>vývar</strong>, <strong>nudle</strong> a
<strong>hovězí</strong>. Už tušíte, co se vyplatí vařit?
Můžeme se zkusit jiný dotaz. Elasticsearch nově podporuje tzv. <a href="http://www.elasticsearch.org/blog/significant-terms-aggregation/">agregaci
podstatných
výrazů</a>.
Pod tímhle šíleným pojmem se skrývá užitečná pomůcka. Dokáže zjistit,
jaká slova se <strong>vyskytují mezi vítěznými polévkami</strong> a naopak <strong>nejsou
mezi ostatními</strong>. Příklad? Tady je:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    "query": {
      "match": {
        winner: true
      }
    },
    "aggregations": {
      "polevka_odchylky": {
        "terms": {
          "field": "polevka",
          "size": 10
        }
      }
    }
  }
</code></pre></div></div>

<p>a odpověď?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
    ...
    },
    "aggregations": {
      "polevka_odchylky": {
        "doc_count": 245,
        "buckets": [{
          "key": "domacim",
          "doc_count": 4,
          "score": 0.05084548104956269,
          "bg_count": 4
        }, {
          "key": "kremova",
          "doc_count": 18,
          "score": 0.037570060094008456,
          "bg_count": 49
        }, {
          "key": "cibulova",
          "doc_count": 4,
          "score": 0.037411078717201174,
          "bg_count": 5
        }, {
          "key": "celestynskymi",
          "doc_count": 5,
          "score": 0.026239067055393583,
          "bg_count": 9
        }, {
          "key": "spenatova",
          "doc_count": 3,
          "score": 0.025539358600583092,
          "bg_count": 4
        }...
        ]
</code></pre></div></div>

<p>Tady je vidět, že z celkem 4 polévek označených jako <strong>domácí</strong> všechny
vyhrály. <strong>Cibulové</strong> polévky mají taky slušné skóre: čtyři z pěti.
Pokud neumíte cibulačku, vyplatí se zkusit polévku <strong>krémovou</strong>,
<strong>špenátovou</strong> nebo aspoň nasypat do polévky <strong>celestýnské</strong> nudle.
Dá se zkusit i obrácený dotaz. Která polévka je téměr zárukou prohry?
Zkuste si dotaz sami (hint <code class="highlighter-rouge">match {winner: false}</code>) a zjistíte, že s
<strong>zelňačkou</strong> nebo <strong>dýňovou</strong> polévkou se ani nemá smysl dělat. A
rozhodně do ní nesypejte <strong>krutony!</strong></p>

<h3 id="má-vůbec-smysl-se-hlásit">Má vůbec smysl se hlásit?</h3>

<p>Překvapivě zajímavé výsledky dává analýza textu, kterým se soutěžící
prezentují. Typická výherkyně (Ano, výherkyně. Dam soutěží celkově víc,
ale muži mají o trochu větší šanci na výhru).
Takže typická výherkyně se používá v popisu jako <strong>ráda</strong>, <strong>vaření</strong>,
<strong>vztah</strong> a <strong>rodina</strong>. A jmenuje se <strong>Lucie</strong> – 7 z 9 Lucií vyhrálo.
Oproti tomu typická nevýherkyně <strong>žije</strong>, <strong>sama</strong> a zmiňuje <strong>peníze</strong>.
Zajímavé, co? Pokud se navíc zmíní, že je <strong>rozvedená</strong>, tak už ani
nemusí zapínat sporák (36 z 38 nevyhrálo).</p>

<h3 id="takže-jaké-menu">Takže jaké menu?</h3>

<p>Nejčastější vítězné menu vypadá nějak takhle:</p>

<p><strong>Kuřecí salát</strong>
<strong>Hovězí vývar</strong>
<strong>Kuře s bramborem</strong>
<strong>Koláč</strong></p>

<p>Ale černým koněm soutěže bude následují menu:</p>

<p><strong>Pancetta</strong> (nebo salát s rajčátky)
<strong>Domácí cibulová polévka</strong> (pozor na to domácí!)
<strong>Marinovaná vepřová pečeně s bramborem</strong>
<strong>Čokoládové sufflé</strong> (nebo palačinka nebo medovník)</p>

<p>Proč? Agregace podstatných výrazů říká, že když se jakékoliv z těchto
jídel objevilo v soutěži, tak bylo součástí vítězného menu.
Navíc se hodí být <strong>muž</strong>, jmenovat se <strong>Lucie</strong> a mít v oblibě
<strong>hokej</strong>.</p>

<p>A taky trochu umět vařit.</p>

                <hr>
            </div>
        </div>
    </div>
    <div class="content-block">
        <div class="article__misc">
            <div class="article__miscitem">
                <div class="sharebox">
    <ul class="sharebox__items">
        <li class="sharebox__item sharebox__item--twitter">
            <a class="sharebox__item-body" href="https://twitter.com/intent/tweet?text=Jak vyhrát Prostřeno?&url=https://fragaria.cz/blog/2015/03/05/jak-vyhrat-prostreno/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter"><span>Share on Twitter</span></a>
        </li>
        <li class="sharebox__item sharebox__item--facebook">
            <a class="sharebox__item-body" href="https://facebook.com/sharer.php?u=https://fragaria.cz/blog/2015/03/05/jak-vyhrat-prostreno/" rel="nofollow" target="_blank" title="Share on Facebook"><span>Share on Facebook</span></a>
        </li>
        <li class="sharebox__item sharebox__item--gplus">
            <a class="sharebox__item-body" href="https://plus.google.com/share?url=https://fragaria.cz/blog/2015/03/05/jak-vyhrat-prostreno/" rel="nofollow" target="_blank" title="Share on Google+"><span>Share on Google+</span></a>
        </li>
    </ul>
</div>

            </div>
            <div class="article__miscitem">
                <div class="taglist" itemscope itemtype="http://schema.org/WebPage">
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/npm/" itemprop="relatedLink">npm</a>
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/elasticsearch/" itemprop="relatedLink">elasticsearch</a>
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/nodejs/" itemprop="relatedLink">nodejs</a>
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/prostreno/" itemprop="relatedLink">prostreno</a>
    
</div>

            </div>
        </div>
    </div>
</article>

        </div>

        <script src="/website/assets/js/site.js"></script>
    </body>
</html>
