<!DOCTYPE html>
<html lang="cs" dir="ltr" itemtype="http://schema.org/WebPage" itemscope="">
    <head>
    
    
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Jak vyhrát Prostřeno? | fragaria.cz</title>
    <meta name="author" content="Fragaria s.r.o." />
    <meta name="robots" content="index,follow" />
    <meta name="description" content="Jak uspět v populární soutěži? Analýza dat s použitím Elasticsearch ukazuje, že uspějete s českou klasikou: domácí hovězí vývar s nudlemi, kuře s bramborem a koláč. Ale taky se hodí někoho milovat, jmenovat se Lucie a hrát hokej.Jak jsem na to přišel?Moje drahá polovička je velká fanynka pořadu Prostřeno. Dost často se tak vr...">
    <meta name="keywords" content="fragaria, software, vývoj software, webové aplikace, python, javascript, angular, elasticsearch, html, css, npmelasticsearchnodejsprostreno" />
    <!-- Favicons -->
    

    <meta property="og:url"           content="https://fragaria.cz/website/blog/2015/03/05/jak-vyhrat-prostreno/" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="Jak vyhrát Prostřeno? | fragaria.cz" />
    <meta property="og:description"   content="Jak uspět v populární soutěži? Analýza dat s použitím Elasticsearch ukazuje, že uspějete s českou klasikou: domácí hovězí vývar s nudlemi, kuře s bramborem a koláč. Ale taky se hodí někoho milovat, jmenovat se Lucie a hrát hokej.Jak jsem na to přišel?Moje drahá polovička je velká fanynka pořadu Prostřeno. Dost často se tak vr..." />

    

    
    <link rel="stylesheet" href="/website/assets/styles.css">
</head>



    <body class="page-container baseline-grid baseline-grid--visible">
        <div class="page-container__inner">
            <div class="sitenav-wrapper content-block">
    <nav class="sitenav" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
        <img alt="Fragaria.cz" class="sitenav__brand" src="/website/assets/img/strawberry.svg">

        <ul class="sitenav__linkset">
            <li class="sitenav__linkset-item sitenav__linkset-item--fill"><a href="/website/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Fragaria.cz</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/works/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Works</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/team/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Team</span></a></li>
            
                <li class="sitenav__linkset-item sitenav__linkset-item--active"><a href="/website/blog/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Blog</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/career/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Career</span></a></li>
            
        </ul>
    </nav>
</div>


            <article itemtype="http://schema.org/BlogPosting" itemscope="">
  <div class="content-block">
    <h1 itemprop="headline">Jak vyhrát Prostřeno?</h1>
    Jak uspět v populární soutěži? Analýza dat s použitím Elasticsearch ukazuje, že uspějete s českou klasikou: <b>domácí hovězí vývar s nudlemi, kuře s bramborem a koláč</b>. Ale taky se hodí někoho <b>milovat</b>, jmenovat se <b>Lucie</b> a hrát <b>hokej</b>.<br />Jak jsem na to přišel?<br /><br/><a name='more'></a>Moje drahá polovička je velká fanynka pořadu Prostřeno. Dost často se tak vrátím z práce domů a z obýváku zrovna nadšeně hýká Vašek Vydra. <br />Pro neznalé – <a href="http://www.iprima.cz/prostreno/o-poradu">Prostřeno</a> je pořad televize Prima, ve kterém: <br /><blockquote>„Pětice amatérských kuchařů, milovníků dobrého jídla a pití, během jednoho týdne postupně předvede, jak si představuje perfektní večeři včetně zábavy pro hosty, kteří se dříve neznali.“</blockquote>Při nedobrovolném sledování mě napadlo, jestli existuje něco jako <b>ideální menu</b> – tedy zda <i>lze sestavit večeři s velkou pravděpodobností výhry?</i><br />Show běží už pět let a po celou tu dobu udržuje webové stránky, na kterých lze nalézt recepty jednotlivých účastníků. To už je spousta dat, ze kterých se dá ledacos vyčíst.<br />Nejdřív ovšem ta data musíme dostat do použitelné podoby. Prima bohužel neposkytuje API (proč taky), takže to je třeba zrobit ručně.<br /><br/><h3>Příprava</h3>Než se pustíme do samotného programování, je potřeba se podívat, jak stránky Prostřeno vůbec vypadají. Začneme na <a href="http://www.iprima.cz/prostreno/soutezici?day=1267448067">stránce s nejstarším vysíláním</a>.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-dE37yw9kiTc/VPMxPANTwfI/AAAAAAAAAe4/wduKmRTPMm8/s1600/Screen%2BShot%2B2015-03-01%2Bat%2B15.40.31.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">    <img border="0" src="http://3.bp.blogspot.com/-dE37yw9kiTc/VPMxPANTwfI/AAAAAAAAAe4/wduKmRTPMm8/s400/Screen%2BShot%2B2015-03-01%2Bat%2B15.40.31.png" height="368" width="640" />  </a></div>Vidíme pět soutěžících, z nichž František je označen korunkou – vítěz kola. Je poznat, že stránky dělal někdo zodpovědný – obrázek každého účastníka je obalen v <code>div</code>u s třídou <code>prostreno-contestant</code>. Vítěz má ještě navíc třídu <code>tvwinner</code>.<br />S tím už se dá pracovat.<br /><br/><h3>Sbíráme data</h3>Pro sběr dat jsem si připravil jednoduchý skript v NodeJS, který, který načte data ze stránek Primy a uloží je ve formátu JSON do databáze Elasticsearch. Formát uložených dat je následující: <br /><pre><code><br />{<br />  "predkrm": "Kuřecí salát v broskvi",<br />  "hlavni": "Candát s mandlovou nádivkou a šťouchané brambory",<br />  "zakusek": "Líná hospodyňka",<br />  "id": "jiri-mueller",<br />  "winner": true,<br />  "gender": "M",<br />  "desc": "\n       Je ženatý, má čtyři děti ... atd."<br />}<br /></code></pre>Nebudu se tady pouštět do detailů a případného zájemce odkážu na <a href="https://gist.github.com/krtek/a3d9d68081ec629a5a16"> kompletní zdrojové kódy</a>.<br /><br/><h3>Agregujeme data</h3>Data se mi úspěšně podařilo nacpat do Elasticsearch, který mám nastavený podle <a href="http://blog.fragaria.cz/2014/11/fulltext-cesky-pomoci-djanga.html">Filipova návodu</a> tak, aby uměl pracoval s češtinou. Teď nastává ta nejzábavnější část – analýza dat. Elasticsearch poskytuje mocné API pro <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations.html">agregace dat</a>. <br />Pojďme si pro začátek zjistit nejčastější vítězné polévky. Dotaz do Elasticsearch bude vypadat následovně: <br /><pre><code><br />  {<br />    "query": {<br />      "match": {<br />        winner: true<br />      }<br />    },<br />    "aggregations": {<br />      "polevka": {<br />        "terms": {<br />          "field": "polevka",<br />          "size": 10<br />        }<br />      }<br />    }<br />  }<br /></code></pre>a odpověď Elasticsearch serveru bude: <br /><pre><code><br />  {<br />    ...<br />    },<br />    "aggregations": {<br />      "polevka": {<br />        "doc_count_error_upper_bound": 5,<br />        "sum_other_doc_count": 276,<br />        "buckets": [{<br />          "key": "polevka",<br />          "doc_count": 69<br />        }, {<br />          "key": "vyvar",<br />          "doc_count": 32<br />        }, {<br />          "key": "nudle",<br />          "doc_count": 20<br />        }, {<br />          "key": "hovezi",<br />          "doc_count": 18<br />        }, {<br />          "key": "kremova",<br />          "doc_count": 18<br />        }, ...<br />        ]<br />      }<br />    }<br />  }<br /></code></pre>Nejčastějším slovem mezi vítěznými polévkami je překvapivě <b>polévka</b>. To se dalo čekat. Ale hned na dalších místech je <b>vývar</b>, <b>nudle</b> a <b>hovězí</b>. Už tušíte, co se vyplatí vařit?<br />Můžeme se zkusit jiný dotaz. Elasticsearch nově podporuje tzv. <a href="http://www.elasticsearch.org/blog/significant-terms-aggregation/">agregaci podstatných výrazů</a>. Pod tímhle šíleným pojmem se skrývá užitečná pomůcka. Dokáže zjistit, jaká slova se <b>vyskytují mezi vítěznými polévkami</b> a naopak <b>nejsou mezi ostatními</b>. Příklad? Tady je: <br /><pre><code><br />  {<br />    "query": {<br />      "match": {<br />        winner: true<br />      }<br />    },<br />    "aggregations": {<br />      "polevka_odchylky": {<br />        "terms": {<br />          "field": "polevka",<br />          "size": 10<br />        }<br />      }<br />    }<br />  }<br /></code></pre>a odpověď? <br /><pre><code><br />  {<br />    ...<br />    },<br />    "aggregations": {<br />      "polevka_odchylky": {<br />        "doc_count": 245,<br />        "buckets": [{<br />          "key": "domacim",<br />          "doc_count": 4,<br />          "score": 0.05084548104956269,<br />          "bg_count": 4<br />        }, {<br />          "key": "kremova",<br />          "doc_count": 18,<br />          "score": 0.037570060094008456,<br />          "bg_count": 49<br />        }, {<br />          "key": "cibulova",<br />          "doc_count": 4,<br />          "score": 0.037411078717201174,<br />          "bg_count": 5<br />        }, {<br />          "key": "celestynskymi",<br />          "doc_count": 5,<br />          "score": 0.026239067055393583,<br />          "bg_count": 9<br />        }, {<br />          "key": "spenatova",<br />          "doc_count": 3,<br />          "score": 0.025539358600583092,<br />          "bg_count": 4<br />        }...<br />        ]<br /></code></pre>Tady je vidět, že z celkem 4 polévek označených jako <b>domácí</b> všechny vyhrály. <b>Cibulové</b> polévky mají taky slušné skóre: čtyři z pěti. Pokud neumíte cibulačku, vyplatí se zkusit polévku <b>krémovou</b>, <b>špenátovou</b> nebo aspoň nasypat do polévky <b>celestýnské</b> nudle. <br />Dá se zkusit i obrácený dotaz. Která polévka je téměr zárukou prohry? Zkuste si dotaz sami (hint <code>match {winner: false}</code>) a zjistíte, že s <b>zelňačkou</b> nebo <b>dýňovou</b> polévkou se ani nemá smysl dělat. A rozhodně do ní nesypejte <b>krutony!</b><br /><br/><h3>Má vůbec smysl se hlásit?</h3>Překvapivě zajímavé výsledky dává analýza textu, kterým se soutěžící prezentují. Typická výherkyně (Ano, výherkyně. Dam soutěží celkově víc, ale muži mají o trochu větší šanci na výhru). <br/>  Takže typická výherkyně se používá v popisu jako <b>ráda</b>, <b>vaření</b>, <b>vztah</b> a <b>rodina</b>. A jmenuje se <b>Lucie</b> – 7 z 9 Lucií vyhrálo.<br />Oproti tomu typická nevýherkyně <b>žije</b>, <b>sama</b> a zmiňuje <b>peníze</b>. Zajímavé, co? Pokud se navíc zmíní, že je <b>rozvedená</b>, tak už ani nemusí zapínat sporák (36 z 38 nevyhrálo).<br /><br/><h3>Takže jaké menu?</h3>Nejčastější vítězné menu vypadá nějak takhle: <br /><br /><b>Kuřecí salát</b> <br /><b>Hovězí vývar</b> <br /><b>Kuře s bramborem</b> <br /><b>Koláč</b> <br /><br />Ale černým koněm soutěže bude následují menu:<br /><br /><b>Pancetta</b> (nebo salát s rajčátky)<br /><b>Domácí cibulová polévka</b> (pozor na to domácí!)<br /><b>Marinovaná vepřová pečeně s bramborem</b><br /><b>Čokoládové sufflé</b> (nebo palačinka nebo medovník)<br /><br />Proč? Agregace podstatných výrazů říká, že když se jakékoliv z těchto jídel objevilo v soutěži, tak bylo součástí vítězného menu.<br />Navíc se hodí být <b>muž</b>, jmenovat se <b>Lucie</b> a mít v oblibě <b>hokej</b>.<br /><br/>A taky trochu umět vařit.
  </div>
</article>

        </div>
    </body>
</html>
