<!DOCTYPE html>
<html lang="cs" dir="ltr" itemtype="http://schema.org/WebPage" itemscope="">
    <head>
    
    
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WebAssembly a cesta k němu | fragaria.cz</title>
    <meta name="author" content="Fragaria s.r.o." />
    <meta name="robots" content="index,follow" />
    <meta name="description" content="Je to asi měsíc, co Brendan Eich (autor JavaScriptu) zveřejnil na svém blogu oznámení o WebAsembly, binárním formátu pro vykonavatelný kód, který by měl v budoucnu koexistovat v prohlížečích vedle JavaScriptu. Pokud projekt nevyzní do ztracena (a zdá se, že má všechny předpoklady pro to, aby se to nestalo), jedná se zřejmě o ...">
    <meta name="keywords" content="fragaria, software, vývoj software, webové aplikace, python, javascript, angular, elasticsearch, html, css, javascriptwebassemblyasm.js" />
    <!-- Favicons -->
    

    <meta property="og:url"           content="https://fragaria.cz/website/blog/2015/07/23/webassembly-cesta-k-nemu/" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="WebAssembly a cesta k němu | fragaria.cz" />
    <meta property="og:description"   content="Je to asi měsíc, co Brendan Eich (autor JavaScriptu) zveřejnil na svém blogu oznámení o WebAsembly, binárním formátu pro vykonavatelný kód, který by měl v budoucnu koexistovat v prohlížečích vedle JavaScriptu. Pokud projekt nevyzní do ztracena (a zdá se, že má všechny předpoklady pro to, aby se to nestalo), jedná se zřejmě o ..." />

    

    
    <link rel="stylesheet" href="/website/assets/styles.css">
</head>



    <body class="page-container baseline-grid baseline-grid--visible">
        <div class="page-container__inner">
            <div class="sitenav-wrapper content-block">
    <nav class="sitenav" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
        <img alt="Fragaria.cz" class="sitenav__brand" src="/website/assets/img/strawberry.svg">

        <ul class="sitenav__linkset">
            <li class="sitenav__linkset-item sitenav__linkset-item--fill"><a href="/website/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Fragaria.cz</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/works/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Works</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/team/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Team</span></a></li>
            
                <li class="sitenav__linkset-item sitenav__linkset-item--active"><a href="/website/blog/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Blog</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/career/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Career</span></a></li>
            
        </ul>
    </nav>
</div>


            <article itemtype="http://schema.org/BlogPosting" itemscope="">
  <div class="content-block">
    <h1 itemprop="headline">WebAssembly a cesta k němu</h1>
    <p>Je to asi měsíc, co Brendan Eich (autor JavaScriptu) <a href="https://brendaneich.com/2015/06/from-asm-js-to-webassembly/">zveřejnil na svém blogu</a> oznámení o WebAsembly, binárním formátu pro vykonavatelný kód, který by měl v budoucnu koexistovat v prohlížečích vedle JavaScriptu. Pokud projekt nevyzní do ztracena (a zdá se, že má všechny předpoklady pro to, aby se to nestalo), jedná se zřejmě o poměrně velkou novinku.</p><a name='more'></a><p>Tato novinka ovšem nepřichází jako blesk z čistého nebe, předcházela jí víceletá snaha různých stran o to, aby prohlížeče podporovaly i jiné jazyky než JavaScript - ať už nativně (vzpomeňme třeba ve své době velké ambice jazyka <a href="https://www.dartlang.org/">Dart</a> od Googlu) nebo pomocí kompilace. Je to právě současný přístup ke kompilaci do JavaScriptu, konkrétně <a href="http://asmjs.org/">asm.js</a>, ze kterého WebAssembly vychází, a který se snaží posunout zase o krok dále. Pojdme si tedy o asm.js říci něco bližšího.</p><h3>LLVM a Emscripten</h3><p>Než se dostaneme k samotnému asm.js, je třeba se zmínit ještě o projektu <a href="http://llvm.org/">LLVM</a>, což je sada nástrojů pro optimalizaci během kompilace a generování nativního kódu. Klasická kompilace jazyků jako je C nebo C++ do binární formy (v tomto případě pomocí LLVM) zjednodušeně funguje nějak takhle:</p><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-HRuz6pT1KDo/VawKmZseNgI/AAAAAAAAAAY/KMdIChZwKss/s1600/Diagram1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-HRuz6pT1KDo/VawKmZseNgI/AAAAAAAAAAY/KMdIChZwKss/s640/Diagram1.png" /></a></div><ul><li>Frontend je komponenta zodpovědná za převod původního jazyka (např. C, C++, ale i jiných) do jakéhosi mezijazyka, tzv. Intermediate Representation (IR). Každý zdrojový jazyk má typicky svůj frontend.</li><li>Optimizer optimalizuje program; na vstupu i na výstupu je IR.</li><li>Backend je zodpovědný za převod IR do nativního kódu. Každá CPU architektura má svůj backend.</li></ul><p>Je nutné, aby backend generoval nativní kód? Ukazuje se, že není - pro LLVM je možné napsat jakýkoli backend, který přeloží IR do libovolné jiné formy. Takovým backendem je i <a href="http://kripken.github.io/emscripten-site/">Emscripten</a>, který místo nativního kódu generuje JavaScript. To znamená, že můžeme vzít program napsaný, dejme tomu, v C++, přeložit ho pomocí Emscripten do JavaScriptu a pustit v prohlížeči. Schematicky znázorněno:</p><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-V3DVwO6_7Gc/VawKor0ZtFI/AAAAAAAAAAg/Eya3ghISLs4/s1600/Diagram2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-V3DVwO6_7Gc/VawKor0ZtFI/AAAAAAAAAAg/Eya3ghISLs4/s640/Diagram2.png" /></a></div><p>A zde již do hry vstupuje asm.js.</p><h3>Asm.js</h3><p>Jak již bylo řečeno, LLVM backendy typicky generují strojový kód, který se v zásadě skládá z jednoduchých aritmetických operací. Emscripten sice generuje JavaScript, ale ani tento kód neobsahuje nic než relativně jednoduché instrukce. Jinými slovy, celá škála dynamických vlastností JavaScriptu, dynamickým typováním počínaje a garbage collection konče, není v kódu, který vytvoří Emscripten, vůbec využita.</p><p>Toho si všimli v Mozille a napadlo je - pokud bychom mohli počítat s tím, že kus Javascriptu nevyužívá dynamické vlastnosti jazyka, mohli bychom výrazně zrychlit jeho vykonávání. V tom případě totiž javascriptový engine může přeskočit velké množství různých runtime kontrol, a dokonce si může kusy kódu předkompilovat.</p><p>Výsledkem byl projekt asm.js - jasně definovaná podmnožina JavaScriptu, která nevyužívá dynamických vlastností jazyka, a může proto běžet výrazně rychleji než "obvyklý" JavaScript, pokud je tomu daný javascriptový engine uzpůsoben. Díky tomu, že se stále jedná o platný JavaScript, odpadají problémy se zpětnou kompatibilitou - prohlížeče, které asm.js nepodporují, mohou asm.js kód zpracovávat stejně jako jakýkoli jiný JavaScript.</p>Podobně jako jsme zvyklí používat 'use strict' direktivu, je možné na začátku modulů a funkcí deklarovat použití asm.js pomocí direktivy 'use asm'. <p>Narazí-li prohlížeč podporující asm.js na tuto direktivu, ověří, zda se jedná o validní asm.js kód, a následně jej vykoná s příslušnými optimalizacemi. Asm.js dnes podporuje především Mozilla Firefox, ale do jisté míry (čti: dojde ke zrychlení, ale k méně dramatickému) i Chrome a <a href="http://blogs.msdn.com/b/ie/archive/2015/02/18/bringing-asm-js-to-the-chakra-javascript-engine-in-windows-10.aspx">výhledově i Internet Explorer</a>. Podle <a href="http://arewefastyet.com/#machine=28&amp;view=breakdown&amp;suite=asmjs-apps">benchmarků</a> se zdá, že ve Firefoxu běží asm.js kód jen asi 1,5x pomaleji než nativní verze.</p><p>Shrnuto: dnes tedy můžeme psát kód pro web v různých jazycích (při využtí asm.js asi nejsnáz stále v C/C++), který v prohlížeči poběží téměř tak rychle jako by běžel nativně. Dá se to ještě zlepšit?</p><h3>WebAssembly</h3><p>Asm.js má i nevýhody:</p><ul><li>Z koncepčního hlediska se zdá přinejmenším podezřelé "schovávat" nízkoúrovňový jazyk do JavaScriptu.</li><li>Výsledek pořád ještě není tak rychlý jak by mohl být. Brendan Eich ve svém úvodním příspěvku píše, že dekomprese a parsování asm.js kódu jsou tím, co výsledný uživatelský zážitek momentálně nejvíce zpomaluje.</li><li>Sémantika JavaScriptu jakožto kompilačního cíle může být z hlediska některých zdrojových jazyků omezující.</li></ul><p>Tyto problémy by měl řešit nový standard nazvaný <a href="https://github.com/WebAssembly">WebAssembly</a>. Jedná se o binární formát pro nízkoúrovňový kód, který v první fázi bude koexpresivní s asm.js (aby umožnil konverzi WebAssembly do asm.js v prohlížečích, které web assembly třeba nebudou zpočátku podporovat), ale v budoucnu se předpokládá jeho další rozvoj za hranice možností sémantiky JavaScriptu.</p><p>První výsledky vypadají slibně - viz <a href="http://blogs.unity3d.com/2015/06/18/webgl-webassembly-and-feature-roadmap/">tento článek</a>, kde se mimo jiné dočteme:</p><blockquote cite="http://blogs.unity3d.com/2015/06/18/webgl-webassembly-and-feature-roadmap/"><i>Experimenting with a prototype WebAssembly format on a build of our AngryBots demo, we saw the size of the generated JavaScript code go from 19.0 MB of asm.js code (gzip-compressed to 4.1 MB) down to 6.3 MB of WebAssembly code (gzip-compressed to 3.0 MB). This means that the amount of data the browser needs to process gets reduced by 3.0x, and the compressed download size gets reduced by 1.4x.</i></blockquote><p>Připočtěme k tomu fakt, že na standardu WebAssembly údajně spolupracují Mozilla, Google i Microsoft, a myslím, že je jasné, že potenciál posunout web zase o krok dál má tento projekt opravdu velký.</p><p>Pokud vás to zaujalo, můžete si přečíst <a href="http://www.2ality.com/2015/06/web-assembly.html">tento článek</a>, který o WebAssembly pojednává o něco podrobněji.</p>
  </div>
</article>

        </div>
    </body>
</html>
