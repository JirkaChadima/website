<!DOCTYPE html>
<html lang="cs" dir="ltr" itemtype="http://schema.org/WebPage" itemscope="">
    <head>
    
    
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Alarmy v Androidu | fragaria.cz</title>
    <meta name="author" content="Fragaria s.r.o." />
    <meta name="robots" content="index,follow" />
    <meta name="description" content="Účelem toho příspěvku není vytvořit návod jak si na vašem telefonu sesystémem Android nastavit budík na šestou ráno, ale nahlédnou trochu podpokličku mechanizmu, který se postará o spuštění libovolné akce někdy vbudoucnosti. A jak už to tak na Androidu bývá, nejedná se o mechanizmusjeden, ale hnedněkolik.">
    <meta name="keywords" content="fragaria, software, vývoj software, webové aplikace, python, javascript, angular, elasticsearch, html, css, alarm, android, scheduler" />
    <!-- Favicons -->
    

    <meta property="og:url"           content="https://fragaria.cz/website/blog/2016/12/09/alarmy-v-androidu/" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="Alarmy v Androidu | fragaria.cz" />
    <meta property="og:description"   content="Účelem toho příspěvku není vytvořit návod jak si na vašem telefonu sesystémem Android nastavit budík na šestou ráno, ale nahlédnou trochu podpokličku mechanizmu, který se postará o spuštění libovolné akce někdy vbudoucnosti. A jak už to tak na Androidu bývá, nejedná se o mechanizmusjeden, ale hnedněkolik." />

    

    
    <link rel="stylesheet" href="/website/assets/styles.css">
    <link rel="alternate" type="application/atom+xml" href="/website/feed.xml" title="Atom feed for this page"/>
    <link rel="self" type="application/atom+xml" href="/website/feed.xml"/>
</head>



    <body class="page-container baseline-grid js-baseline-grid">
        <div class="page-container__inner">
            <div class="content-block js-sitenav">
    <nav class="sitenav" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
        <a href="/website/">
            <img alt="Fragaria s.r.o." class="sitenav__brand" src="/website/assets/img/strawberry.svg">
        </a>

        <ul class="sitenav__linkset">
            <li class="sitenav__linkset-item sitenav__linkset-item--main"><a href="/website/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Fragaria.cz</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/#works" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Works</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/#team" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Team</span></a></li>
            
                <li class="sitenav__linkset-item sitenav__linkset-item--active"><a href="/website/blog/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Blog</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/career/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Career</span></a></li>
            
        </ul>

        <div class="sitenav__menu-toggle typeset">
            <a href="#" class="sitenav__menu-toggle-link js-sitenav-menu-toggle">Menu</a>
        </div>
    </nav>
</div>


            <article itemtype="https://schema.org/TechArticle" itemscope class="article">
    <div class="content-block typeset">
        <h1 itemprop="name" class="article__headline">Alarmy v Androidu</h1>
        <meta itemprop="headline" content="Alarmy v Androidu">

        
            <meta itemprop="image" content="https://4.bp.blogspot.com/-vEW67W0Rf4Q/WEp92ed7nDI/AAAAAAAAArk/u2A0ZCXRMDUsHkkxmKkcQc0ai33JqlzRgCLcB/s72-c/numbers-time-watch-white.jpg">
        

        <div itemprop="publisher" itemtype="http://schema.org/Organization" class="hidden" itemscope>
            <div itemprop="logo" itemtype="http://schema.org/ImageObject" itemscope="">
                <meta itemprop="url" content="https://fragaria.cz/website/assets/img/strawberry.svg">
            </div>
            <meta itemprop="name" content="Fragaria s.r.o.">
        </div>

        <p class="article__meta">
            <span itemprop="author" itemtype="http://schema.org/Person" itemscope="" class="article__author">
                by <span itemprop="name">Milan Slezák</span>
            </span>
            <meta itemprop="datePublished" content="" />
            <span class="article__pubdate">09.12.2016</span>
            <meta itemprop="publisher"></meta>
        </p>

        

        <div class="article__content-wrap">
            <div class="article__content">
                <p>Účelem toho příspěvku není vytvořit návod jak si na vašem telefonu se
systémem Android nastavit budík na šestou ráno, ale nahlédnou trochu pod
pokličku mechanizmu, který se postará o spuštění libovolné akce někdy v
budoucnosti. A jak už to tak na Androidu bývá, nejedná se o mechanizmus
jeden, ale hned
několik.</p>

<p><a href="https://4.bp.blogspot.com/-vEW67W0Rf4Q/WEp92ed7nDI/AAAAAAAAArk/u2A0ZCXRMDUsHkkxmKkcQc0ai33JqlzRgCLcB/s1600/numbers-time-watch-white.jpg"><img src="https://4.bp.blogspot.com/-vEW67W0Rf4Q/WEp92ed7nDI/AAAAAAAAArk/u2A0ZCXRMDUsHkkxmKkcQc0ai33JqlzRgCLcB/s320/numbers-time-watch-white.jpg" alt="" /></a></p>

<h3 id="k-čemu-alarmy">K čemu alarmy?</h3>

<p>Potřebujete vyvolat nějakou akci ve vzdálenější budoucnosti jako třeba
rozeznít uživatelův budík? Rádi byste pravidelně synchronizovali data
mezi apkou a serverem a popřípadě uživatele upozornili notifikací, že se
objevily nějaké novinky, které stojí za to si prohlédnut? Něco vám
našeptává že držet kvůli tomu při životě celou aplikaci není to pravé?
V tom případě je alarm nebo chce-li job, přesně to co potřebujete.</p>

<p>Jedná se totiž o způsob, jak systému Android sdělit, že má za uvedený
časový interval nastartovat vaší aplikaci a nechat ji provést nějakou
akci. Vzbudit jak? No samozřejmě pomocí dobře známého <strong>Intentu</strong>
jakožto standardního prostředku meziaplikační komunikace. Zdá se to být
jednoduché až primitivní, ale přece jenom za tím nějaké to tajemství
je.</p>

<h3 id="baterie-především">Baterie především</h3>

<p>Ždímat baterii je většinou to poslední co uživatel od aplikace očekává a
proto by měla být četnost alarmů co nejmenší. Tedy samozřejmě tak malá,
aby vaše aplikace stále dávala smysl.</p>

<p>Představte si aplikaci která má za úkol varovat vás například před
zvýšenou koncentrací škodlivin a smogu ve vašem okolí. Logické asi
bude pravidelně posílat serveru vaší lokaci (pokud se mění) a jako
odpověd dostávat informaci zda v ní byly překročeny limity či nikoliv.
Je třeba správně vybalancovat nastavenou periodu dotazování na server
tak, aby k dotazům nedocházelo příliš často, ale zároveň aby uživatel
nestihl strávit odpoledne v Bohumíně aniž by se dozvěděl, že riskuje
zdraví.</p>

<p>Jako doplněk ke správnému načasováni však existuje ještě jedna technika
jak nějaké ty miliampérhodiny ušetřit.</p>

<h3 id="nepřesné-alarmy">Nepřesné alarmy</h3>

<p>Ano vážně, pokud nebudete trvat na spuštění v přesně definovaný čas,
pomůžete tím Androidu ušetřit nemalou část baterie.</p>

<p>Android totiž, když zrovna nemá nic na práci, usne. V tomto stavu má
nejmenší odběr a baterii tím šetří. Každý alarm ho však vzbudí a donutí
provést rozličné rutiny jako například inicializovat spojení do
internetu. Vaše aplikace však v systému není sama a takto ho budí
aplikací hned několik. Pokud však při nastavování alarmu řeknete, že jej
chcete provést například za 10 minut plus mínus jedna minuta, umožníte
tím systému seskupit alarmy různých aplikací a provést tak více
činností v rámci jednoho probuzení.</p>

<p>Tato optimalizace má na životnost baterie nemalý vliv. Navíc dochází k
randomizaci jednotlivých volání což jistě ocení i váš server.</p>

<h3 id="alarmující-mechanismy">Alarmující mechanismy</h3>

<p>Jak již bylo uvedeno na začátku k nastavování alarmů lze využít hned
několik mechanismů. Jedná se o:</p>

<ul>
  <li>Alarm Manager </li>
  <li>Firebase Job Dispatcher </li>
  <li>Job Scheduler </li>
</ul>

<h3 id="alarm-manager">Alarm Manager</h3>

<p>Jedná se o nejstarší a zároveň nejméně efektivní způsob přístupu k
alarmům. Jeho výhodou je, že do standardního Android SDK patří od
začátku a není zde problém s kompatibilitou. Nevýhodou je že
nepodporuje “Nepřesné alarmy” a je tedy nejméně efektivní metodou. Jeho
API je dosti obecné a neposkytuje takový komfort jako následující dva
bratříčci.</p>

<h3 id="job-scheduler">Job Scheduler</h3>

<p>Naproti tomu Job Scheduler je nejmodernější způsob jak tuto problematiku
řešit. API je čisté a intuitivní, jeho použití je efektivní. Nevýhodou
je, že byl zařazen do standardního SDK až od verze 21+ a není tedy
příliš použitelný pro aplikace vyžadující zpětnou kompatibilitu.</p>

<h3 id="firebase-job-dispatcher">Firebase Job Dispatcher</h3>

<p>Je knihovna jež přináší zpětnou kompatibilitu už od verze 9+. Má velmi
podobné API jako výše uvedený Job Scheduler, který také pro verze 21+
interně používá. Pro verze &lt; 21 interně využívá mechanismus GCM (GCM
Task service) a vyžaduje tedy závislost na balíku Play Services. Tato
závislost může být nevýhodou neboť na některých zařízeních nemusí být k
dispozici.</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Kompatibilita</th>
      <th>Efektivita</th>
      <th>Play services</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Alarm Manager</td>
      <td>1+</td>
      <td>nízká</td>
      <td>nevyžaduje</td>
    </tr>
    <tr>
      <td>Job Scheduler</td>
      <td>21+</td>
      <td>vysoká</td>
      <td>nevyžaduje</td>
    </tr>
    <tr>
      <td>Firebase Job Dispatcher</td>
      <td>9+</td>
      <td>vysoká</td>
      <td>vyžaduje</td>
    </tr>
  </tbody>
</table>

<h3 id="trocha-praxe">Trocha praxe</h3>

<p>Na závěr si ukážeme jak vytvořit jednoduchou službu, která bude
pravidelně (co 10 minut) kontrolovat náš server. Zvolenou technologií je
<strong>Firebase Job Dispatcher</strong>, jež je dle mého názoru nejrozumějším
kompromisem. Pro absolutní kompatibilitu by bylo třeba příklad ještě
doplnit o neefektivní mechanizmus založený na Alarm Manageru.</p>

<p>Nejprve přidáme gradle závislost:</p>

<p>Vytvoříme vlastní službu:</p>

<p>Kterou zaregistrujeme do manifest.xml:</p>

<p>A nyní už to jen celé spustit:</p>

<p>A pokud bychom to chtěli vypnout:</p>

<h3 id="závěrem">Závěrem</h3>

<p>Ok, ale proč tři způsoby ptáte se? Odpověď je jednoduchá, “Protože
Android”. Tato evolučně velmi živá platforma skýtá mnoho takovýchto
mysteriózních zákoutí.</p>

                <hr>
            </div>
        </div>
    </div>
    <div class="content-block">
        <div class="article__misc">
            <div class="article__miscitem">
                <div class="sharebox">
    <ul class="sharebox__items">
        <li class="sharebox__item sharebox__item--twitter">
            <a class="sharebox__item-body" href="https://twitter.com/intent/tweet?text=Alarmy v Androidu&url=https://fragaria.cz/blog/2016/12/09/alarmy-v-androidu/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter"><span>Share on Twitter</span></a>
        </li>
        <li class="sharebox__item sharebox__item--facebook">
            <a class="sharebox__item-body" href="https://facebook.com/sharer.php?u=https://fragaria.cz/blog/2016/12/09/alarmy-v-androidu/" rel="nofollow" target="_blank" title="Share on Facebook"><span>Share on Facebook</span></a>
        </li>
        <li class="sharebox__item sharebox__item--gplus">
            <a class="sharebox__item-body" href="https://plus.google.com/share?url=https://fragaria.cz/blog/2016/12/09/alarmy-v-androidu/" rel="nofollow" target="_blank" title="Share on Google+"><span>Share on Google+</span></a>
        </li>
    </ul>
</div>

            </div>
            <div class="article__miscitem">
                <div class="taglist" itemscope itemtype="http://schema.org/WebPage">
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/alarm/" itemprop="relatedLink">alarm</a>
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/android/" itemprop="relatedLink">android</a>
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/scheduler/" itemprop="relatedLink">scheduler</a>
    
</div>

            </div>
        </div>
    </div>
</article>

            <footer class="content-block">
    <div class="footer">
        <div class="footer__meta">
            <a href="/website/">
                <img alt="Fragaria s.r.o." class="footer__brand" src="/website/assets/img/strawberry.svg">
            </a>
            <div class="footer__copy">
                <div class="footer__copy-line">FRAGARIA (C) 2018</div>
                <div class="footer__copy-line">Hard at work building the awesome.</div>
            </div>
        </div>
        <div class="footer__social">
            
                <a href="https://twitter.com/fragariacz" class="icon--twitter footer__social-icon"></a>
            
            
                <a href="https://linkedin.com/company/fragaria-ltd-" class="icon--linkedin footer__social-icon"></a>
            
            
                <a href="https://plus.google.com/+FragariaCz"class="icon--gplus footer__social-icon"></a>
            
            
                <a href="https://github.com/fragaria"class="icon--github footer__social-icon"></a>
            
        </div>
    </div>
</footer>

        </div>

        <script src="/website/assets/js/site.js"></script>
    </body>
</html>
