<!DOCTYPE html>
<html lang="cs" dir="ltr" itemtype="http://schema.org/WebPage" itemscope="">
    <head>
    
    
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Jak se vyrábí aplikace na chytré hodinky Pebble Time Round | fragaria.cz</title>
    <meta name="author" content="Fragaria s.r.o." />
    <meta name="robots" content="index,follow" />
    <meta name="description" content="Když se v dubnu 2012 na Kickstarteru objevily hodinkyPebble s e-ink displayem, za měsíc získalyčástku přesahující deset milionů dolarů. Na jaře 2013 jste si o ně snámi mohlizasoutěžit.">
    <meta name="keywords" content="fragaria, software, vývoj software, webové aplikace, python, javascript, angular, elasticsearch, html, css, pebble, javascript, smartwatch" />
    <!-- Favicons -->
    

    <meta property="og:url"           content="https://fragaria.cz/website/blog/2016/01/22/jak-se-vyrabi-aplikace-na-chytre/" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="Jak se vyrábí aplikace na chytré hodinky Pebble Time Round | fragaria.cz" />
    <meta property="og:description"   content="Když se v dubnu 2012 na Kickstarteru objevily hodinkyPebble s e-ink displayem, za měsíc získalyčástku přesahující deset milionů dolarů. Na jaře 2013 jste si o ně snámi mohlizasoutěžit." />

    
        <meta property="og:image"         content="http://1.bp.blogspot.com/-QHnjsH8mG88/VppH0Jg9WGI/AAAAAAAAAAw/-3RzKDQj0k8/s72-c/ezgif.com-crop-mariopebble.gif" />
    

    <link rel="stylesheet" href="/website/assets/styles.css">
    <link rel="alternate" type="application/atom+xml" href="/website/feed.xml" title="Atom feed for this page"/>
    <link rel="self" type="application/atom+xml" href="/website/feed.xml"/>
</head>



    <body class="page-container baseline-grid js-baseline-grid">
        <div class="page-container__inner">
            <div class="content-block js-sitenav">
    <nav class="sitenav" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
        <a href="/website/">
            <img alt="Fragaria s.r.o." class="sitenav__brand" src="/website/assets/img/strawberry.svg">
        </a>

        <ul class="sitenav__linkset">
            <li class="sitenav__linkset-item sitenav__linkset-item--main"><a href="/website/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Fragaria.cz</span></a></li>
            
                <li class="sitenav__linkset-item  js-sitenav-link"><a href="/website/#works" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Works</span></a></li>
            
                <li class="sitenav__linkset-item  js-sitenav-link"><a href="/website/#team" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Team</span></a></li>
            
                <li class="sitenav__linkset-item sitenav__linkset-item--active js-sitenav-link"><a href="/website/blog/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Blog</span></a></li>
            
                <li class="sitenav__linkset-item  js-sitenav-link"><a href="/website/career/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Career</span></a></li>
            
        </ul>

        <div class="sitenav__menu-toggle typeset">
            <a href="#" class="sitenav__menu-toggle-link js-sitenav-menu-toggle">Menu</a>
        </div>
    </nav>
</div>


            <article itemtype="https://schema.org/TechArticle" itemscope class="article">
    <div class="content-block typeset">
        <h1 itemprop="name" class="article__headline">Jak se vyrábí aplikace na chytré hodinky Pebble Time Round</h1>
        <meta itemprop="headline" content="Jak se vyrábí aplikace na chytré hodinky Pebble Time Round">

        
            <meta itemprop="image" content="http://1.bp.blogspot.com/-QHnjsH8mG88/VppH0Jg9WGI/AAAAAAAAAAw/-3RzKDQj0k8/s72-c/ezgif.com-crop-mariopebble.gif">
        

        <div itemprop="publisher" itemtype="http://schema.org/Organization" class="hidden" itemscope>
            <div itemprop="logo" itemtype="http://schema.org/ImageObject" itemscope="">
                <meta itemprop="url" content="https://fragaria.cz/website/assets/img/strawberry.svg">
            </div>
            <meta itemprop="name" content="Fragaria s.r.o.">
        </div>

        <p class="article__meta">
            <span itemprop="author" itemtype="http://schema.org/Person" itemscope="" class="article__author">
                by <span itemprop="name">Jirka Chadima</span>
            </span>
            <meta itemprop="datePublished" content="" />
            <span class="article__pubdate">22.01.2016</span>
            <meta itemprop="publisher"></meta>
        </p>

        

        <div class="article__content-wrap">
            <div class="article__content">
                <p>Když se v dubnu 2012 na Kickstarteru objevily hodinky
<a href="https://www.pebble.com/">Pebble</a> s e-ink displayem, za měsíc získaly
částku přesahující deset milionů dolarů. Na jaře 2013 jste si o ně s
námi mohli
<a href="http://www.fragaria.cz/o-nas/tiskove-zpravy/2013/5/2/soutez-o-hodinky-pebble/">zasoutěžit</a>.</p>

<p>Dnes si ukážeme, jak se pro Pebble vyvíjí. Nebude to sice vítězný
<a href="http://www.fragaria.cz/soutez/">Připomínač léků</a>, ale částečně se
přiblížíme jednomu z finalistů, Navigaci na zápěstí.</p>

<p>Místo původního soutěžního modelu se podíváme na
nejnovější kousek, Pebble Time Round, který se poměrně v tichosti
objevil v září letošního roku. Co nabízí? 64barevný kulatý e-ink
display, integraci s Androidem i iOS, při váze necelých 30 gramů výdrž
pohodově přesahující 50 hodin, 4 tlačítka a pár senzorů. A taky
<a href="https://apps.getpebble.com/en_US/application/55431083b7d4a71c0000003b?section=watchfaces">Maria</a>,
<a href="https://apps.getpebble.com/en_US/application/55566afbef1c155748000039?section=watchfaces">Nyan
Cat</a>
nebo třeba
<a href="https://apps.getpebble.com/en_US/application/565510b84431a2820600000c?&amp;section=watchfaces">Hollyho</a>.</p>

<p><a href="http://1.bp.blogspot.com/-QHnjsH8mG88/VppH0Jg9WGI/AAAAAAAAAAw/-3RzKDQj0k8/s1600/ezgif.com-crop-mariopebble.gif"><img src="http://1.bp.blogspot.com/-QHnjsH8mG88/VppH0Jg9WGI/AAAAAAAAAAw/-3RzKDQj0k8/s200/ezgif.com-crop-mariopebble.gif" alt="" /></a><a href="http://3.bp.blogspot.com/-ZMPYA14Jj-U/VppHzOMwt6I/AAAAAAAAAAo/VXP16d8CN3A/s1600/rsz_2016-01-10_131125.jpg"><img src="http://3.bp.blogspot.com/-ZMPYA14Jj-U/VppHzOMwt6I/AAAAAAAAAAo/VXP16d8CN3A/s200/rsz_2016-01-10_131125.jpg" alt="" /></a><a href="http://1.bp.blogspot.com/-SlmcBLxeKHA/VppH0nI0RrI/AAAAAAAAAA4/M0DM78GkT5Q/s1600/ezgif.com-crop-nyan.gif"><img src="http://1.bp.blogspot.com/-SlmcBLxeKHA/VppH0nI0RrI/AAAAAAAAAA4/M0DM78GkT5Q/s200/ezgif.com-crop-nyan.gif" alt="" /></a></p>

<p>Pro vývojáře je k dispozici kombinované SDK v C a Javascriptu. Co z
principu nezvládnou hodinky totiž Pebble outsourcuje do telefonu, kde
běží JS engine s přístupem třeba k internetu nebo geolokaci. Nad SDK
existuje i <a href="https://github.com/pebble/pebblejs">wrapper kompletně
v Javascriptu</a>, který je ale trochu
pozadu a Time Round k mému velkému zklamání <a href="https://github.com/pebble/pebblejs/issues/116">zatím ještě
nepodporuje</a>.</p>

<p>Kromě lokální instalace se dá tvořit i v <a href="https://cloudpebble.net/">cloudovém
editoru</a>, jenže to je samozřejmě málo
hardcore, takže využijeme <a href="https://developer.getpebble.com/sdk/install">dodávaného toolu v
Pythonu</a>, který nám kromě
SDK nainstaluje i užitečné blbiny jako emulátor prostředí hodinek,
webový emulátor senzorů nebo nástroj na deployment přímo do fyzického
zařízení.</p>

<p>A co si dnes uvaříme? Uplácáme si <a href="https://github.com/JirkaChadima/pebble-csas-nearest">primitivní
aplikaci</a>, která
nás nasměruje k nejbližšímu bankomatu České spořitelny. Budeme
potřebovat:</p>

<ul>
  <li>Data z ČS <a href="https://developers.csas.cz/html/devs/poi.html">WebAPI
Places</a>,</li>
  <li>komunikaci mezi C a JS částí aplikace,</li>
  <li>kreslení grafických primitiv,</li>
  <li>magnetický kompas z hodinek,</li>
  <li>geolokaci v mobilu,</li>
  <li>internet v mobilu.</li>
</ul>

<p>Celá aplikace bude nakonec vypadat jako na následujícím obrázku. Při
spuštění zjístíme aktuální polohu, získáme nejbližší bankomat,
spočítáme jeho vzdálenost a po naběhnutí magnetometrického kompasu
zobrazíme šipku ve správném směru. Ideálně by se pak šipka a počet metrů
měly v čase měnit podle toho, jak se k bankomatu
přibližujeme.</p>

<p><a href="http://3.bp.blogspot.com/-7AZD2b8YDec/VppH0IpZo8I/AAAAAAAAAA8/DDtATAFKx3c/s1600/DSC_0046.jpg">http://3.bp.blogspot.com/-7AZD2b8YDec/VppH0IpZo8I/AAAAAAAAAA8/DDtATAFKx3c/s1600/DSC_0046.jpg</a></p>

<p>Začneme tím, že potřebujeme data nějak zobrazovat. Pebble pracuje s
konceptem oken (obrazovek) a vrstev různého typu. Aby aplikace nebyla
moc složitá, rozhodl jsem se použít jenom jedno okno a a v něm textovou
vrstvu pro každou řádku informací a jednu vrstvu navíc pro šipku
ukazující směr k bankomatu. Pokud (zatím) nejsou k dispozici žádné
informace, zobrazuje se pouze nápis <em>Loading…</em></p>

<p>Všechna data kromě směru šipky budeme do hodinek pushovat z JS části
aplikace v telefonu. Triggerem pro získání dat v telefonu bude buď
spuštění aplikace, nebo timer, který bude data požadovat každou
minutu. Při každém vrácení dat se pak na hodinkách překreslí celé view.
Nezávisle na JS části aplikace se bude překreslovat navigační šipka.</p>

<p>JS z telefonu si s C aplikací v hodinkách povídá pomocí jednoduchého
obousměrného protokolu zpráv. Množina zpráv je definovaná v
<a href="https://github.com/JirkaChadima/pebble-csas-nearest/blob/master/appinfo.json#L15">konfiguračním
souboru</a>,
a na
<a href="https://github.com/JirkaChadima/pebble-csas-nearest/blob/master/src/js/pebble-js-app.js#L73">obou</a>
<a href="https://github.com/JirkaChadima/pebble-csas-nearest/blob/master/src/message_callbacks.c#L21">koncích</a>
aplikace je pak zadrátované chování pro jednotlivé zprávy. JS tak
obsahuje následující kód pro zjištění nejbližšího bankomatu, <a href="https://github.com/JirkaChadima/pebble-csas-nearest/blob/master/src/js/pebble-js-app.js#L13-L38">dopočítání
azimutu</a>
a poslání dat do hodinek. Stejná funkce se volá na obě události
definované v hodinkách, a to jsou spuštění aplikace a pravidelná žádost
o refresh dat.</p>

<p>V hodinkách potom zaslaná událost vyvolá
<a href="https://github.com/JirkaChadima/pebble-csas-nearest/blob/master/src/ui.c#L54-L64">překreslení</a>
kompletního UI a zobrazí získaná data na display.</p>

<p>Ale jak namalovat šipku? A jak s ní točit podle aktuálního směru k
bankomatu? Pebble nabízí přímé kreslení polygonů pomocí definice
<a href="https://github.com/JirkaChadima/pebble-csas-nearest/blob/master/src/layers.c#L4">jednotlivých
vrcholů</a>.
Na definovaný obrys se pak dá aplikovat rotace podle zvoleného úhlu,
nadefinuje se barva výplně a můžeme kreslit. Aktuální natočení šipky pak
spočítáme podle předpočítaného azimutu k bankomatu (KEY_DIRECTION) a
aktuálního nasměrování hodinek. Překreslení šipky bude vyvoláno i změnou
nasměrování hodinek ze <a href="https://github.com/JirkaChadima/pebble-csas-nearest/blob/master/src/compass.c#L14">služby poslouchající
události</a>
vyvolané
<a href="https://developer.getpebble.com/guides/pebble-apps/sensors/magnetometer/">magnetometrem</a>
v hodnikách, který jde při vývoji <a href="https://developer.getpebble.com/guides/publishing-tools/pebble-tool/#emu-control">simulovat z
browseru</a>.</p>

<p>No, a to je všechno, teď by aplikace měla fungovat a měla by se chovat
tak, jak chceme. Můžeme jí pomocí <a href="https://developer.getpebble.com/guides/publishing-tools/developer-connection/">vývojářského
spojení</a>nahrát
do fyzických hodinek, nebo jí vypublikovat do <a href="https://apps.getpebble.com/en_US/application/56818e4e94ffb216e400001f">Pebble
store</a>.
Podle statistik jsem zatím získal velmi pěkná 3 stažení.</p>

<p>Jak ale doopravdy funguje? Po několika dnech pokusů a testování
v reálném provozu musím říct, že dvakrát spolehlivě se to nechová…
Jako nejproblematičtější se jeví komunikace s GPS v telefonu, která s
Androidem spíš nefunguje než funguje, nicméně s iOS je to trochu lepší.
Taky se mi nepovedlo aplikaci vnutit nějakou hezkou ikonku.</p>

<p>Dalším omezením je relativní roztříštěnost platformy. Ačkoliv jde teprve
o pátý model značky, jedná se už o třetí kompletní iteraci vnitřní
platformy a sjednocování jde poměrně pomalu. Tím pak samozřejmě trpí i
dokumentace a okolní nástroje, zejména pak zmiňovaný JS wrapper. S jeho
pomocí je vývoj na všechny platformy výrazně jednodušší a přímočařejší.
Pokud bychom chtěli aplikaci naportovat na starší modely, musí se ručně
zoptimalizovat celá řada drobností, a to je prostě nuda.</p>

<p>Dává tedy smysl se nyní zabývat hodinkami Pebble, potažmo jakýmikoliv
jinými chytrými hodinkami? <strong>Podle mého názoru to má ještě čas.</strong></p>

<p>I na stavu a stabilitě vývojářských nástrojů je hrozně vidět, že se
jedná o velmi mladou oblast, která vlastně ještě hledá, k čemu by mohla
být lidstvu užitečná. Očekává se, že v polovině roku představí Apple
novou verzi svých Apple Watch a já se vsadím, že budou z velké části
nekompatibilní s těmi původními. Zatím jedinou extrémně přínosnou funkcí
je to, že při každé notifikaci nemusíte tahat telefon z kapsy.</p>

            </div>
        </div>
    </div>
    <div class="content-block">
        <div class="article__misc">
            <div class="article__miscitem">
                <div class="sharebox">
    <ul class="sharebox__items">
        <li class="sharebox__item sharebox__item--twitter">
            <a class="sharebox__item-body" href="https://twitter.com/intent/tweet?text=Jak se vyrábí aplikace na chytré hodinky Pebble Time Round&url=https://fragaria.cz/blog/2016/01/22/jak-se-vyrabi-aplikace-na-chytre/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter"><span>Share on Twitter</span></a>
        </li>
        <li class="sharebox__item sharebox__item--facebook">
            <a class="sharebox__item-body" href="https://facebook.com/sharer.php?u=https://fragaria.cz/blog/2016/01/22/jak-se-vyrabi-aplikace-na-chytre/" rel="nofollow" target="_blank" title="Share on Facebook"><span>Share on Facebook</span></a>
        </li>
        <li class="sharebox__item sharebox__item--gplus">
            <a class="sharebox__item-body" href="https://plus.google.com/share?url=https://fragaria.cz/blog/2016/01/22/jak-se-vyrabi-aplikace-na-chytre/" rel="nofollow" target="_blank" title="Share on Google+"><span>Share on Google+</span></a>
        </li>
    </ul>
</div>

            </div>
            <div class="article__miscitem">
                <div class="taglist" itemscope itemtype="http://schema.org/WebPage">
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/pebble/" itemprop="relatedLink">pebble</a>
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/javascript/" itemprop="relatedLink">javascript</a>
    
        
        <a class="taglist__tag" href="/website/blog/archive/tag/smartwatch/" itemprop="relatedLink">smartwatch</a>
    
</div>

            </div>
        </div>
    </div>
</article>

            <footer class="content-block">
    <div class="footer">
        <div class="footer__meta">
            <a href="/website/">
                <img alt="Fragaria s.r.o." class="footer__brand" src="/website/assets/img/strawberry.svg">
            </a>
            <div class="footer__copy">
                <div class="footer__copy-line footer__copy-line--emphasized">FRAGARIA (C) 2018</div>
                <div class="footer__copy-line">Talk is cheap, show me the code.</div>
            </div>
        </div>
        <div class="footer__social">
            
                <a href="https://twitter.com/fragariacz" class="icon--twitter footer__social-icon"></a>
            
            
                <a href="https://linkedin.com/company/fragaria-ltd-" class="icon--linkedin footer__social-icon"></a>
            
            
                <a href="https://plus.google.com/+FragariaCz"class="icon--gplus footer__social-icon"></a>
            
            
                <a href="https://github.com/fragaria"class="icon--github footer__social-icon"></a>
            
        </div>
    </div>
</footer>

        </div>

        <script src="/website/assets/js/site.js"></script>
    </body>
</html>
