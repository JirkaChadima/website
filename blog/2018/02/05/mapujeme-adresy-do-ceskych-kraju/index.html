<!DOCTYPE html> <html lang="cs" dir="ltr" itemtype="http://schema.org/WebPage" itemscope=""> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Mapujeme adresy do českých krajů | fragaria.cz</title> <meta name="author" content="Fragaria s.r.o." /> <meta name="robots" content="index,follow" /> <meta name="description" content="Občas potkáte jako vývojář zábavné a jednoduché zadání, jako třeba“Vím, že lidé platí v mých prodejnách po celé republice. Chtěl bychvědět, kolik se toho děje v každém kraji.” Zkušený borec si řekne, žeprostě vezme mapu krajů, na ně napáruje adresy prodejen a hotovo… V tuchvíli ale netuší, že před ním leží křivolaká cesta pln..."> <meta name="keywords" content="fragaria, software, vývoj software, webové aplikace, python, javascript, angular, elasticsearch, html, css, geodata, openstreetmap, javascript" /> <!-- Favicons --> <meta property="og:url" content="https://fragaria.cz/website/blog/2018/02/05/mapujeme-adresy-do-ceskych-kraju/" /> <meta property="og:type" content="website" /> <meta property="og:title" content="Mapujeme adresy do českých krajů | fragaria.cz" /> <meta property="og:description" content="Občas potkáte jako vývojář zábavné a jednoduché zadání, jako třeba“Vím, že lidé platí v mých prodejnách po celé republice. Chtěl bychvědět, kolik se toho děje v každém kraji.” Zkušený borec si řekne, žeprostě vezme mapu krajů, na ně napáruje adresy prodejen a hotovo… V tuchvíli ale netuší, že před ním leží křivolaká cesta pln..." /> <meta property="og:image" content="https://res.cloudinary.com/fragaria/image/upload/w_640,c_fit,f_jpg,q_auto/fragaria.cz/posts/2018-02-05-mapujeme-adresy-do-ceskych-kraju__1.png" /> <link rel="stylesheet" href="/website/assets/styles.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="alternate" type="application/atom+xml" href="/website/feed.xml" title="Atom feed for this page"/> <link rel="self" type="application/atom+xml" href="/website/feed.xml"/> </head> <body class="page-container baseline-grid js-baseline-grid"> <div class="page-container__inner"> <div class="content-block js-sitenav sitenav-wrapper"> <nav class="sitenav content-block__cover--mobile" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement"> <a href="/website/"> <img alt="Fragaria s.r.o." class="sitenav__brand" src="/website/assets/img/strawberry.svg"> </a> <ul class="sitenav__linkset"> <li class="sitenav__linkset-item sitenav__linkset-item--main"><a href="/website/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Fragaria.cz</span></a></li> <li class="sitenav__linkset-item js-sitenav-link"><a href="/website/#works" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Works</span></a></li> <li class="sitenav__linkset-item js-sitenav-link"><a href="/website/#team" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Team</span></a></li> <li class="sitenav__linkset-item sitenav__linkset-item--active js-sitenav-link"><a href="/website/blog/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Blog</span></a></li> <li class="sitenav__linkset-item js-sitenav-link"><a href="/website/career/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Career</span></a></li> </ul> <div class="sitenav__menu-toggle typeset"> <a href="#" class="sitenav__menu-toggle-link js-sitenav-menu-toggle">Menu</a> </div> </nav> </div> <article itemtype="https://schema.org/TechArticle" itemscope class="article"> <div class="content-block typeset"> <h1 itemprop="name" class="article__headline">Mapujeme adresy do českých krajů</h1> <meta itemprop="headline" content="Mapujeme adresy do českých krajů"> <div itemprop="publisher" itemtype="http://schema.org/Organization" class="hidden" itemscope> <div itemprop="logo" itemtype="http://schema.org/ImageObject" itemscope=""> <meta itemprop="url" content="https://fragaria.cz/website/assets/img/strawberry.svg"> </div> <meta itemprop="name" content="Fragaria s.r.o."> </div> <p class="article__meta"> <span itemprop="author" itemtype="http://schema.org/Person" itemscope="" class="article__author"> by <span itemprop="name">Jirka Chadima</span> </span> <meta itemprop="datePublished" content="" /> <span class="article__pubdate">05.02.2018</span> <meta itemprop="publisher"></meta> </p> <div class="article__content-wrap"> <div class="article__content"> <p>Občas potkáte jako vývojář zábavné a jednoduché zadání, jako třeba “<strong>Vím, že lidé platí v mých prodejnách po celé republice. Chtěl bych vědět, kolik se toho děje v každém kraji.</strong>” Zkušený borec si řekne, že prostě vezme mapu krajů, na ně napáruje adresy prodejen a hotovo… V tu chvíli ale netuší, že před ním leží křivolaká cesta plná slepých uliček, nezrušených zákonů, neúplných datových zdrojů a zajímavých algoritmů.</p> <figure class="content-block__cover--mobile"> <img src="https://res.cloudinary.com/fragaria/image/upload/w_640,c_limit,f_jpg,q_auto,dpr_2.0/fragaria.cz/posts/2018-02-05-mapujeme-adresy-do-ceskych-kraju__1.png" srcset="https://res.cloudinary.com/fragaria/image/upload/w_640,c_limit,f_jpg,q_auto/fragaria.cz/posts/2018-02-05-mapujeme-adresy-do-ceskych-kraju__1.png 1x, https://res.cloudinary.com/fragaria/image/upload/w_640,c_limit,f_jpg,q_auto,dpr_2.0/fragaria.cz/posts/2018-02-05-mapujeme-adresy-do-ceskych-kraju__1.png 2x, https://res.cloudinary.com/fragaria/image/upload/w_640,c_limit,f_jpg,q_auto,dpr_3.0/fragaria.cz/posts/2018-02-05-mapujeme-adresy-do-ceskych-kraju__1.png 3x" /> </figure> <h2 id="hledáme-data">Hledáme data</h2> <p>Na úvod se sluší říct, co všechno o prodejně víme:</p> <ul> <li>Ulice, město, PSČ, stát - to se píše na obálky, to známe</li> <li>GPS souřadnice - to se píše do mobilů, to známe</li> <li>RUIAN ID - Cože?</li> </ul> <p><a href="https://vdp.cuzk.cz/">RUIAN</a> (Registr územní identifikace, adres a nemovitostí) je státní katalog, který se používá zejména pro katastrální účely a hodí se při práci s mapovými podklady, adresními místy a dalšími prvky, které se týkají fyzického umístění nějakého objektu v krajině. To zní skvěle, tam určitě budou kraje! No, nejsou.</p> <h2 id="slepá-ulička">Slepá ulička?</h2> <p>PSČ všichni běžně používáme pro adresování dopisů, a asi také každý víme, že specifické PSČ přísluší specifické poště, která obsluhuje nějaké území. To by mohlo pasovat s kraji! No, nepasuje.</p> <p>Na webu České pošty se k seznamu všech PSČ samozřejmě <a href="https://www.ceskaposta.cz/ke-stazeni/zakaznicke-vystupy">dostanete</a> (<em>Seznam PSČ částí obcí a obcí bez částí</em>), ale když se do něj podíváte, zjistíte, že nejvyšší celek, který se k PSČ dozvíte, je okres. Moment, my ještě máme okresy? Ano, máme. A stejně tak máme <strong>dvoje</strong> kraje. Cože? Skutečně, dle zákonných norem u nás stále rozlišujeme kraje <a href="https://cs.wikipedia.org/wiki/Okresy_v_%C4%8Cesku">územní a samosprávní</a>.</p> <p>Nicméně s tím už se dá pracovat, takže si vesele vyrobíte mapování PSČ -&gt; okres -&gt; kraj a myslíte si, že máte hotovo. Chyba lávky! Ukazuje se totiž (a vzhledem k často diskutovanému rušení a slučování vesnických pošt se to dalo čekat), že jedno PSČ může sahat klidně do třech okresů. Těch případů je zhruba 10 %, a to se bohužel zanedbat nedá, potřebujeme pro tyhle případy náhradní řešení.</p> <h2 id="hledáme-data-podruhé">Hledáme data podruhé</h2> <p>Takže přichází na řadu GPS souřadnice, s nimi to musí být brnkačka. Kraje nejsou nic jiného než polygony, a algoritmů na párování bodu do polygonu existuje <a href="http://erich.realtimerendering.com/ptinpoly/">celá řada</a>. Ale kde vzít ty polygony? Katastrální úřad? Tam už jsme byli a našli RUIAN. Ministerstvo vnitra? Jestli taková data poskytují, tak je mají pečlivě schovaná. Jednotlivé kraje? Spíš ne. Český statistický úřad? Do nich jsem vkládal velkou naději, a taky nic. My si snad budeme muset obkreslit mapu!</p> <p>Naštěstí po chvíli googlení najdete přesně to, <a href="https://navigovat.mobilmania.cz/clanky/navod-pro-gsak-jak-rozdelit-ceske-geokese-podle-kraju/sc-265-a-1313623/default.aspx">co potřebujete</a>. V 10 let starém článku. Tak si s tím chvíli hrajete, začnete psát testy, a najednou vám zcela náhodně vybraná souřadnice nefunguje. Co to? Hranice krajů se totiž <a href="https://www.czso.cz/csu/xb/uzemni_zmeny">můžou</a> měnit! Třeba když se rozpustí nějaký ten vojenský újezd. Takže data jsou to sice pěkná, ale zastaralá. Co teď? Vážně jdeme obkreslovat mapu?</p> <h2 id="open-street-map-zachraňuje">Open Street Map zachraňuje</h2> <p>Není třeba, na záchranu přispěchá Open Street Map a jejich <a href="https://overpass-turbo.eu/">Overpass</a>. Se <a href="https://overpass-turbo.eu/s/vAm">správně formulovaným dotazem</a> je získání hranic krajů hračka. Mimochodem povšimněte si, že zdrojem dat je náš národní katastrální úřad a jeho dataset s povědomým jménem RUIAN. No prostě Koucourkov. Odtud už je jen krůček k automatizaci celého našeho datasetu.</p> <p>A jeho hezké vizualizaci přímo na githubu (samozřejmě bez těch PSČ, ale zase si můžete všimnout hraničních kamenů):</p> <p>V samotné aplikaci už je to pak jen otázka načtení <a href="https://github.com/JirkaChadima/cz-region-boundaries/blob/master/data/gps/all.txt">dvou</a> <a href="https://github.com/JirkaChadima/cz-region-boundaries/blob/master/data/zip/zip-region.csv">souborů</a> a můžeme vesele párovat: Kvůli výkonu to zkusíme samozřejmě nejdřív podle PSČ a když se zrovna trefíme do nejednoznačně určitelného, tak použijeme jeden z algoritmů pro hledání bodu v polygonu.</p> <h2 id="a-přitom-taková-blbost">A přitom taková blbost</h2> <p>Ano, snad jen slovy klasika lze uzavřít tuhle odyseu. Na druhou stranu možná jenom neumím hledat ve státních datech a některý z mnoha úřadů má krasný portál s open-geodaty týkajícími se nejen krajů, ale třeba i měst a dalších územních ploch. Jestli o něm víte, napište nám!</p> <p>Věřím tomu, že se někomu tahle data mohou hodit, takže všechny zdrojáky a data najdete na <a href="https://github.com/JirkaChadima/cz-region-boundaries">GitHubu</a>, nepravidelně je aktualizuju.</p> </div> </div> </div> <div class="content-block"> <div class="article__misc"> <div class="article__miscitem"> <div class="sharebox"> <ul class="sharebox__items"> <li class="sharebox__item sharebox__item--twitter"> <a class="sharebox__item-body" href="https://twitter.com/intent/tweet?text=Mapujeme adresy do českých krajů&url=https://fragaria.cz/blog/2018/02/05/mapujeme-adresy-do-ceskych-kraju/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter"><span>Share on Twitter</span></a> </li> <li class="sharebox__item sharebox__item--facebook"> <a class="sharebox__item-body" href="https://facebook.com/sharer.php?u=https://fragaria.cz/blog/2018/02/05/mapujeme-adresy-do-ceskych-kraju/" rel="nofollow" target="_blank" title="Share on Facebook"><span>Share on Facebook</span></a> </li> <li class="sharebox__item sharebox__item--gplus"> <a class="sharebox__item-body" href="https://plus.google.com/share?url=https://fragaria.cz/blog/2018/02/05/mapujeme-adresy-do-ceskych-kraju/" rel="nofollow" target="_blank" title="Share on Google+"><span>Share on Google+</span></a> </li> </ul> </div> </div> <div class="article__miscitem"> <div class="taglist" itemscope itemtype="http://schema.org/WebPage"> <a class="taglist__tag" href="/website/blog/archive/tag/geodata/" itemprop="relatedLink">geodata</a> <a class="taglist__tag" href="/website/blog/archive/tag/openstreetmap/" itemprop="relatedLink">openstreetmap</a> <a class="taglist__tag" href="/website/blog/archive/tag/javascript/" itemprop="relatedLink">javascript</a> </div> </div> </div> </div> </article> <footer class="content-block"> <div class="footer"> <div class="footer__meta"> <a href="/website/"> <img alt="Fragaria s.r.o." class="footer__brand" src="/website/assets/img/strawberry.svg"> </a> <div class="footer__copy"> <div class="footer__copy-line footer__copy-line--emphasized">FRAGARIA (C) 2018</div> <div class="footer__copy-line">Talk is cheap, show me the code.</div> </div> </div> <div class="footer__social"> <a href="https://twitter.com/fragariacz" class="icon--twitter footer__social-icon"></a> <a href="https://linkedin.com/company/fragaria-ltd-" class="icon--linkedin footer__social-icon"></a> <a href="https://plus.google.com/+FragariaCz"class="icon--gplus footer__social-icon"></a> <a href="https://github.com/fragaria"class="icon--github footer__social-icon"></a> </div> </div> </footer> </div> <script src="/website/assets/js/site.js?9e00faef3e05e859744dbd885eab4baf"></script> </body> </html>
