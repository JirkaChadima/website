<!DOCTYPE html>
<html lang="cs" dir="ltr" itemtype="http://schema.org/WebPage" itemscope="">
    <head>
    
    
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mapujeme adresy do českých krajů | fragaria.cz</title>
    <meta name="author" content="Fragaria s.r.o." />
    <meta name="robots" content="index,follow" />
    <meta name="description" content="Občas potkáte jako vývojář zábavné a jednoduché zadání, jako třeba "Vím, že lidé platí v mých prodejnách po celé republice. Chtěl bych vědět, kolik se toho děje v každém kraji." Zkušený borec si řekne, že prostě vezme mapu krajů, na ně napáruje adresy prodejen a hotovo... V tu chvíli ale netuší, že před ním leží křivolaká ces...">
    <meta name="keywords" content="fragaria, software, vývoj software, webové aplikace, python, javascript, angular, elasticsearch, html, css, geodataopenstreetmapjavascript" />
    <!-- Favicons -->
    

    <meta property="og:url"           content="https://fragaria.cz/website/blog/2018/02/05/mapujeme-adresy-do-ceskych-kraju/" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="Mapujeme adresy do českých krajů | fragaria.cz" />
    <meta property="og:description"   content="Občas potkáte jako vývojář zábavné a jednoduché zadání, jako třeba "Vím, že lidé platí v mých prodejnách po celé republice. Chtěl bych vědět, kolik se toho děje v každém kraji." Zkušený borec si řekne, že prostě vezme mapu krajů, na ně napáruje adresy prodejen a hotovo... V tu chvíli ale netuší, že před ním leží křivolaká ces..." />

    

    
    <link rel="stylesheet" href="/website/assets/styles.css">
</head>



    <body class="page-container baseline-grid baseline-grid--visible">
        <div class="page-container__inner">
            <div class="sitenav-wrapper content-block js-sitenav">
    <nav class="sitenav" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
        <a href="/website/">
            <img alt="Fragaria s.r.o." class="sitenav__brand" src="/website/assets/img/strawberry.svg">
        </a>

        <ul class="sitenav__linkset">
            <li class="sitenav__linkset-item sitenav__linkset-item--main"><a href="/website/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Fragaria.cz</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/works/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Works</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/team/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Team</span></a></li>
            
                <li class="sitenav__linkset-item sitenav__linkset-item--active"><a href="/website/blog/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Blog</span></a></li>
            
                <li class="sitenav__linkset-item "><a href="/website/career/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Career</span></a></li>
            
        </ul>

        <div class="sitenav__menu-toggle typeset">
            <a href="#" class="sitenav__menu-toggle-link js-sitenav-menu-toggle">Menu</a>
        </div>
    </nav>
</div>


            <article itemtype="http://schema.org/BlogPosting" itemscope="">
  <div class="content-block">
    <h1 itemprop="headline">Mapujeme adresy do českých krajů</h1>
    Občas potkáte jako vývojář zábavné a jednoduché zadání, jako třeba "<b>Vím, že lidé platí v mých prodejnách po celé republice. Chtěl bych vědět, kolik se toho děje v každém kraji.</b>" Zkušený borec si řekne, že prostě vezme mapu krajů, na ně napáruje adresy prodejen a hotovo... V tu chvíli ale netuší, že před ním leží křivolaká cesta plná slepých uliček, nezrušených zákonů, neúplných datových zdrojů a zajímavých algoritmů.<br /><a name='more'></a><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-ZCiJ_QZQkj8/WnCJev76DVI/AAAAAAAAAlg/GJfwYJFxe48ZyGlnJL1-23zULFYKJyYrgCLcBGAs/s1600/Screenshot_2018-01-30_16-02-36.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="402" data-original-width="674" height="379" src="https://3.bp.blogspot.com/-ZCiJ_QZQkj8/WnCJev76DVI/AAAAAAAAAlg/GJfwYJFxe48ZyGlnJL1-23zULFYKJyYrgCLcBGAs/s640/Screenshot_2018-01-30_16-02-36.png" width="640" /></a></div><br /><h2>Hledáme data</h2><div><br />Na úvod se sluší říct, co všechno o prodejně víme:</div><ul><li>Ulice, město, PSČ, stát - to se píše na obálky, to známe</li><li>GPS souřadnice - to se píše do mobilů, to známe</li><li>RUIAN ID - Cože?</li></ul><br /><a href="https://vdp.cuzk.cz/">RUIAN</a> (Registr územní identifikace, adres a nemovitostí) je státní katalog, který se používá zejména pro katastrální účely a hodí se při práci s mapovými podklady, adresními místy a dalšími prvky, které se týkají fyzického umístění nějakého objektu v krajině. To zní skvěle, tam určitě budou kraje! No, nejsou.<br /><br /><h2>Slepá ulička?</h2><br /><div>PSČ všichni běžně používáme pro adresování dopisů, a asi také každý víme, že specifické PSČ přísluší specifické poště, která obsluhuje nějaké území. To by mohlo pasovat s kraji! No, nepasuje.</div><div><br /></div>Na webu České pošty se k seznamu všech PSČ samozřejmě <a href="https://www.ceskaposta.cz/ke-stazeni/zakaznicke-vystupy">dostanete</a> (<i>Seznam PSČ částí obcí a obcí bez částí</i>), ale když se do něj podíváte, zjistíte, že nejvyšší celek, který se k PSČ dozvíte, je okres. Moment, my ještě máme okresy? Ano, máme. A stejně tak máme <b>dvoje</b> kraje. Cože? Skutečně, dle zákonných norem u nás stále rozlišujeme kraje <a href="https://cs.wikipedia.org/wiki/Okresy_v_%C4%8Cesku">územní a samosprávní</a>.<br /><br />Nicméně s tím už se dá pracovat, takže si vesele vyrobíte mapování PSČ -&gt; okres -&gt; kraj a myslíte si, že máte hotovo. Chyba lávky! Ukazuje se totiž (a vzhledem k často diskutovanému rušení a slučování vesnických pošt se to dalo čekat), že jedno PSČ může sahat klidně do třech okresů. Těch případů je zhruba 10 %, a to se bohužel zanedbat nedá, potřebujeme pro tyhle případy náhradní řešení.<br /><br /><h2>Hledáme data podruhé</h2><br />Takže přichází na řadu GPS souřadnice, s nimi to musí být brnkačka. Kraje nejsou nic jiného než polygony, a algoritmů na párování bodu do polygonu existuje <a href="http://erich.realtimerendering.com/ptinpoly/">celá řada</a>. Ale kde vzít ty polygony? Katastrální úřad? Tam už jsme byli a našli RUIAN. Ministerstvo vnitra? Jestli taková data poskytují, tak je mají pečlivě schovaná. Jednotlivé kraje? Spíš ne. Český statistický úřad? Do nich jsem vkládal velkou naději, a taky nic. My si snad budeme muset obkreslit mapu!<br /><br />Naštěstí po chvíli googlení najdete přesně to, <a href="https://navigovat.mobilmania.cz/clanky/navod-pro-gsak-jak-rozdelit-ceske-geokese-podle-kraju/sc-265-a-1313623/default.aspx">co potřebujete</a>. V 10 let starém článku. Tak si s tím chvíli hrajete, začnete psát testy, a najednou vám zcela náhodně vybraná souřadnice nefunguje. Co to? Hranice krajů se totiž <a href="https://www.czso.cz/csu/xb/uzemni_zmeny">můžou</a> měnit! Třeba když se rozpustí nějaký ten vojenský újezd. Takže data jsou to sice pěkná, ale zastaralá. Co teď? Vážně jdeme obkreslovat mapu?<br /><br /><h2>Open Street Map zachraňuje</h2><br />Není třeba, na záchranu přispěchá Open Street Map a jejich <a href="https://overpass-turbo.eu/">Overpass</a>. Se <a href="https://overpass-turbo.eu/s/vAm">správně formulovaným dotazem</a> je získání hranic krajů hračka. Mimochodem povšimněte si, že zdrojem dat je náš národní katastrální úřad a jeho dataset s povědomým jménem RUIAN. No prostě Koucourkov. Odtud už je jen krůček k automatizaci celého našeho datasetu.<br /><br /><script src="https://gist.github.com/JirkaChadima/015b17d3f950b8b48d8ac5d7ee86529e.js"></script>A jeho hezké vizualizaci přímo na githubu (samozřejmě bez těch PSČ, ale zase si můžete všimnout hraničních kamenů): <br /><br /><script src="https://gist.github.com/JirkaChadima/42be088b9f33102d1d33e454011d5883.js"></script>V samotné aplikaci už je to pak jen otázka načtení <a href="https://github.com/JirkaChadima/cz-region-boundaries/blob/master/data/gps/all.txt">dvou</a> <a href="https://github.com/JirkaChadima/cz-region-boundaries/blob/master/data/zip/zip-region.csv">souborů</a> a můžeme vesele párovat: Kvůli výkonu to zkusíme samozřejmě nejdřív podle PSČ a když se zrovna trefíme do nejednoznačně určitelného, tak použijeme jeden z algoritmů pro hledání bodu v polygonu.<br /><br /><script src="https://gist.github.com/JirkaChadima/8ba687a1e9259b0d2cc1c17c618a55dc.js"></script> <br /><h2>A přitom taková blbost</h2><br />Ano, snad jen slovy klasika lze uzavřít tuhle odyseu. Na druhou stranu možná jenom neumím hledat ve státních datech a některý z mnoha úřadů má krasný portál s open-geodaty týkajícími se nejen krajů, ale třeba i měst a dalších územních ploch. Jestli o něm víte, napište nám!<br /><br />Věřím tomu, že se někomu tahle data mohou hodit, takže všechny zdrojáky a data najdete na <a href="https://github.com/JirkaChadima/cz-region-boundaries">GitHubu</a>, nepravidelně je aktualizuju.
  </div>
</article>

        </div>

        <script src="/website/assets/js/site.js"></script>
    </body>
</html>
