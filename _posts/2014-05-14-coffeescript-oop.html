---
layout: post
title: CoffeeScript a OOP
date: '2014-05-14T10:43:00.000+02:00'
author: Robin Gottfried
tags:
- oop
- javascript
- angularjs
- coffeescript
modified_time: '2014-10-13T14:32:32.488+02:00'
blogger_id: tag:blogger.com,1999:blog-5328688426183767847.post-390344130544827557
blogger_orig_url: http://blog.fragaria.cz/2014/05/coffeescript-oop.html
---

Dlouho jsem nemohl přijít CoffeeScriptu na chuť. Přišlo mi, že za málo muziky nabízí hodně potíží. Co mě nakonec přesvědčilo, byla schopnost, po které jsem v JavaScriptu přímo prahnul: <b>Psát skutečné třídy a objekty</b>. <br /><a name='more'></a><br />Když jsem se nadšeně bavil s kolegy, že už jsem taky kafař, že to je fakt hustý kafe a že teď už konečně píšu „objektivně”, zjistil jsem, že tuhle - za mě - nejdůležitější vychytávku, většina kafařů v okolí zatím vůbec nezkusila.<br /><br /><h3>První třída v CoffeScriptu</h3>Nejjednodušší třída vypadá takto:<br /><script src="https://gist.github.com/czervenka/3957ca18976955b77b8a.js?file=a-person.coffee"></script> <br /><ul><li><span style="font-family: Courier New, Courier, monospace;">toString: () -&gt;</span>&nbsp;... vytvoří metodu <span style="font-family: Courier New, Courier, monospace;">Person.prototype.toString</span><span style="font-family: inherit;">.</span></li><li>&nbsp;<span style="font-family: Courier New, Courier, monospace;">constructor: ()</span>&nbsp;... je speciální metoda konstruktoru objektu.</li><li>&nbsp;<span style="font-family: Courier New, Courier, monospace;">@</span>&nbsp;... zavináč je nejdůležitější znak pro objekty v CS, takže:</li><ul><li>&nbsp;<span style="font-family: Courier New, Courier, monospace;">@name</span>&nbsp;... odkazuje na <span style="font-family: Courier New, Courier, monospace;">this.name</span>.</li><li>&nbsp;(<span style="font-family: Courier New, Courier, monospace;">@name</span>) -&gt; ... zavináč v argumentu funkce zajistí automatické uložení do <span style="font-family: Courier New, Courier, monospace;">this.name</span><span style="font-family: inherit;"> před zavoláním metody.</span></li></ul></ul><br /><h3>Statické metody / properties</h3>Ke třídám patří statické metody. Jako vše kolem kafe-objektů i statické vlastnosti se zapisují pomocí zavináče<br /><script src="https://gist.github.com/czervenka/3957ca18976955b77b8a.js?file=b-person.coffee"></script> <br /><ul><li><span style="font-family: Courier New, Courier, monospace;">@</span> před názvem metody - vytvoří metodu jako statickou (jako metodu třídy)</li><li>Ve statické metodě zastupuje <span style="font-family: Courier New, Courier, monospace;">@</span>&nbsp;třídu, a protože třída je v JS to stejné jako konstruktor, <span style="font-family: Courier New, Courier, monospace;">new @(name)</span> vytvoří novou instanci aktuální třídy.</li><li>Podobně lze přistupovat ke statickým metodám z instance (<span style="font-family: Courier New, Courier, monospace;">@fromNames</span>&nbsp;zde stoprocentně nefunguje). Jen je třeba si uvědomit, že konstruktor je pod <span style="font-family: Courier New, Courier, monospace;">@constructor</span>&nbsp;a <span style="font-family: Courier New, Courier, monospace;">@constructor is Person</span>, tedy naši metodu můžeme z instance zavolat jako <span style="font-family: Courier New, Courier, monospace;">@constructor.fromNames(...)</span>.</li></ul><br /><ul></ul><h3>Dědění</h3>Vlastně největší výhodou tříd v CoffeeScriptu je přehledné dědění:<br /><script src="https://gist.github.com/czervenka/3957ca18976955b77b8a.js?file=c-employee.coffee"></script> <br /><ul><li><span style="font-family: Courier New, Courier, monospace;">extends</span>&nbsp;- je samozřejmé klíčové slovo CoffeeScriptu</li><li><span style="font-family: Courier New, Courier, monospace;">Employee.__super__.constructor</span>&nbsp;- uchovává odkaz na předka (v tomto případě&nbsp;<span style="font-family: Courier New, Courier, monospace;">Person</span>)</li><li><span style="font-family: Courier New, Courier, monospace;">super</span>&nbsp;- trochu nesystematicky</li><ul><li>bez argumentů a závorek zavolá stejnojmennou metodu nad rodičem a přepoužije aktuální argumenty (tj. <span style="font-family: Courier New, Courier, monospace;">Employee.__super__.constructor.apply(this, arguments)</span>)</li><li>se závorkami nebo s argumenty zavolá metodu předka pouze s těmito argumenty</li></ul></ul><br /><ul><ul></ul></ul><h3>Vázané metody</h3>Kdo programuje v Java/CoffeeScriptu, setkal se určitě s problémem vázaných metod. Jednoduchý příklad:<br /><script src="https://gist.github.com/czervenka/3957ca18976955b77b8a.js?file=x-invalid-invocation.coffee"></script>JavaScript u metod neuchová informaci, ke kterému objektu patří, takže při jejich volání bez plně kvalifikovaného jména přijde metoda o referenci na <span style="font-family: Courier New, Courier, monospace;">this</span>. <br />To je u asynchronního jazyka, kde každý program je plný callbacků, veliká otrava. Samozřejmě to lze různě obejít a obchází se to (pomocí <span style="font-family: Courier New, Courier, monospace;">function.bind</span> či <span style="font-family: Courier New, Courier, monospace;">self = this</span>), ale CoffeeScript má vlastní pěkné řešení v podobě konstrukce <span style="font-family: Courier New, Courier, monospace;">=&gt;</span><br /><script src="https://gist.github.com/czervenka/3957ca18976955b77b8a.js?file=d-person.coffee"></script> <br /><h3>Použití tříd v AngularJS</h3>AngularJS má vlastní způsob zapouzdření a využití objektového (prototypového) přístupu pro kolegy není úplně intuitivní. Častá námitka, kterou slyším, je: <i>Scope nebo Servisu ale nemůžeš jednoduše dědit.</i><br /><br />Takže, chlapci, můžeš! Stačí jen kávu správně dávkovat v injekcích:<br /><script src="https://gist.github.com/czervenka/3957ca18976955b77b8a.js?file=e-my-directive.coffee"></script>