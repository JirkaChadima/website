---
layout: post
title: Omezení přístupu do AppEngine aplikace
date: '2013-10-16T10:19:00.004+02:00'
author: Lukáš Marek
tags:
- gae
- google app engine
modified_time: '2013-10-21T13:46:27.928+02:00'
blogger_id: tag:blogger.com,1999:blog-5328688426183767847.post-5701532649425033272
blogger_orig_url: http://blog.fragaria.cz/2013/10/omezeni-pristupu-do-appengine-aplikace.html
---

Poměrně často narážíme na požadavek omezení přístupu uživatelů do aplikace na AppEngine.<br /><br />Modelový příklad: Zákazník si přeje omezit přístup do aplikace tak, aby do ní mohli pouze uživatelé z domény <b>xxx.cz</b>, <b>yyy.cz</b> a <b>fragaria.cz</b>.<br /><br />Google nabízí pouze omezení přístupu buď na libovolnou (ale pouze jednu) Google Apps doménu nebo na jakéhokoliv uživatele z Google Apps domény bez omezení.<br /><br />První možnost tedy použít nemůžeme, druhou používáme k vynucení přihlášení uživatele – omezení na Google Apps domény je pro nás OK.<br /><br />Postup, který jsme používali dosud je podobný jako například v <a href="http://blog.abahgat.com/2013/01/07/user-authentication-with-webapp2-on-google-app-engine/">tomto článku</a>. Připravíme si anotaci <b>@user_required</b>, která zkontroluje uživatele a tu "nalepíme" na všechny metody příslušných HTTP handlerů. To ale znamená, že máme anotace rozeseté všude a je snadné jí někde zapomenout.<br /><br />Dneska <a href="https://plus.google.com/115351013889485284951">+Robin Gottfried</a> přišel s mnohem elegantnějším řešením.<br />Využívá metodu <b>__call__()</b> z webapp2, přes kterou procházejí všechny requesty v aplikaci a kontrolu dělá tam.<br /><br />Asi takhle:<br /><br /><script src="https://gist.github.com/krtek/6994910.js?file=__init__.py"></script> Samozřejmě je nutné místo standardní <b>WSGIApplication</b>&nbsp; použít vlastní podtřídu:<br /><br /><script src="https://gist.github.com/krtek/6994910.js?file=utils.py"></script>